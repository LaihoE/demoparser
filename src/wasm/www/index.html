<!DOCTYPE html>

<head>

  <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" sizes="any" type="image/svg+xml" href="/images/favicon.svg">
</head>

<body>
  <div id=wrapper>
    <h1>Find crosshair-codes from a demo</h1>  
    <p>
      <label for="file_picker"></label>
      <input type="file" id="file_picker" name="file_picker">
    </p>

  </div>

  <script type="module">
    import init, { parse_events, initThreadPool  } from './pkg/demoparser2.js';
    await init();

    let myWorker = new Worker(new URL('./worker.js', import.meta.url), { 
              type: 'module'
    }) 

    document.getElementById("file_picker").addEventListener(
        "change",
        async function () {
            let file = this.files[0];
            var startTime = performance.now()


            myWorker.postMessage({ file: file });
            myWorker.onmessage = function (e) {
                var endTime = performance.now()
                console.log(`Parsing took: ${(endTime - startTime) / 1000} seconds`)

                generateTableFromData(e.data)
            };

        },
        false
    );

  </script>




  <script>  function show(shown, hidden) {
    document.getElementById(shown).style.display='block';
    document.getElementById(hidden).style.display='none';
    return false;
  }
  
function generateTableFromData(eventsNoFilter) {
    let events = eventsNoFilter.filter(x => x.get("attacker_team_name") === x.get("user_team_name"));
    const tbl = document.createElement("table");
    const tblBody = document.createElement("tbody");

    tbl.appendChild(tblBody);
    document.body.appendChild(tbl);
    tbl.setAttribute("border", "2");

    var table = document.createElement("TABLE");  //makes a table element for the page
    var column_names = Array.from(events[0].keys());
    
    for (var i = 0; i < events.length; i++) {
        var row = table.insertRow(i);
        for (const [index, element] of column_names.entries()) {
            row.insertCell(index).innerHTML = events[i].get(element);
        }
    }

    var header = table.createTHead();
    var headerRow = header.insertRow(0);
    for (var i = 0; i < column_names.length; i++) {
        headerRow.insertCell(i).innerHTML = column_names[i];
    }
    document.body.append(table);
}

  
  </script>

  
</body>

</html>